#!/bin/bash
set -euo pipefail

: "${SLACK_TOKEN:?The SLACK_TOKEN environment variable is required.}"
#: "${SLACK_CHANNELS:?The SLACK_CHANNELS environment variable is required.}"
export SLACK_CHANNELS="ncov-gisaid-updates"

bin="$(dirname "$0")"

JOB_NAME="${1:?Job name is required as the first argument.}"

if [ ! -z "${AWS_BATCH_JOB_ID}" ]; then
    echo "Notifying Slack about started AWS Batch job. AWS_BATCH_JOB_ID=\"${AWS_BATCH_JOB_ID}\"."
    "bin"/notify-slack "${JOB_NAME} from AWS Batch job \`${AWS_BATCH_JOB_ID}\` started.\nFollow along in your local ncov-ingest repo with: "'```'"nextstrain build --aws-batch --no-download --attach ${AWS_BATCH_JOB_ID} ."'```'
fi
